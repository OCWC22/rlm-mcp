services:
  fleet-rlm:
    build: .
    ports:
      - "${MCP_PORT:-8000}:8000"
    environment:
      - DAYTONA_API_KEY
      - DAYTONA_API_URL
      - DAYTONA_TARGET
      - OPENAI_API_KEY
      - ANTHROPIC_API_KEY
      - ZAI_API_KEY
      - RLM_MODEL
      - RLM_SUBTASK_MODEL
      - RLM_MAX_ITERATIONS
      - MCP_TRANSPORT=streamable-http
      - MCP_PORT=8000
    env_file:
      - path: .env.local
        required: false
    restart: unless-stopped
    healthcheck:
      test: >-
        curl -sf -X POST http://localhost:8000/mcp
        -H "Content-Type: application/json"
        -H "Accept: application/json, text/event-stream"
        -d '{"jsonrpc":"2.0","id":0,"method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"healthcheck","version":"0.1"}}}'
      interval: 30s
      timeout: 5s
      start_period: 10s
      retries: 3
